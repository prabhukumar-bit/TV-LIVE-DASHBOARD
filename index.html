<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Google Sheet Live Dashboard</title>

<style>
html, body {
  height: 100%;
  margin: 0;
  font-family: "Segoe UI", Arial, sans-serif;
  background: linear-gradient(180deg, #e0eafc, #cfdef3);
  display: flex;
  flex-direction: column;
}

#controls {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 10px;
  background: rgba(255,255,255,0.9);
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

#controls button {
  margin: 0 12px;               /* thoda spacing bada */
  padding: 12px 24px;           /* height & width increase */
  font-size: 20px;               /* text bada */
  font-weight: bold;
  border-radius: 12px;           /* thoda rounded */
  border: none;
  cursor: pointer;
  background: linear-gradient(to bottom, #4b6cb7, #182848);
  color: white;
  transition: transform 0.2s, box-shadow 0.2s;
}

#controls button:hover {
  transform: scale(1.1);         /* hover pe thoda aur enlarge */
  box-shadow: 0 6px 15px rgba(0,0,0,0.4);
}


/* ===== REPORT CONTAINER ===== */
#report-container {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
  box-sizing: border-box;
  transition: opacity 0.6s ease, transform 0.6s ease;
}

#report-container.fade {
  opacity: 0;
  transform: scale(0.95);
}

/* ===== TABLE STYLING ===== */
table {
  width: 100%;
  max-width: 95%;
  border-collapse: separate;
  border-spacing: 0;
  border-radius: 15px;
  overflow: hidden;
  box-shadow: 0 15px 40px rgba(0,0,0,0.3), inset 0 0 0 3px #333;
  background: #fff;
  transition: transform 0.3s ease;
}

table tr {
  transition: background 0.3s ease;
}

/* HEADER STYLING */
th {
  background: linear-gradient(to bottom, #4b6cb7, #182848);
  color: #fff;
  font-weight: 900;
  padding: 12px;
  text-align: center;
  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
}

/* CELL STYLING */
td {
  border: 1px solid #333;
  text-align: center;
  vertical-align: middle;
  padding: 12px;
  font-weight: 600;
  position: relative;
  transition: transform 0.2s, box-shadow 0.2s;
}

td::after {
  content: "";
  position: absolute;
  inset: 0;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.2);
  pointer-events: none;
}

td:hover {
  transform: scale(1.03);
  box-shadow: 0 0 15px rgba(0,0,0,0.25);
}

/* OPTIONAL GLOW FOR BOLD CELLS */
td.bold {
  box-shadow: inset 0 0 10px rgba(255, 215, 0, 0.6);
}

</style>
</head>
<body>

<div id="report-container">Loading...</div>

<div id="controls">
  <button id="prev-slide">◀ Previous</button>
  <button id="play-pause">Pause</button>
  <button id="next-slide">Next ▶</button>
</div>

<script>
const SHEET_ID = "1QS69ZNqIehztWHNQR1NDnCzMXOFEPTcgSwQARmRzZig";
const API_KEY = "AIzaSyBw2ua8ipnTs6bGZ2o2CwMbv6ngP5Pl12w";

const RANGES = [
  "JFM!N17:O20",
  "JFM!A136:C142",
  "JFM!A127:D133",
  "JFM!A144:D150",
  "JFM!J16:K20",
  "JFM!A66:C88",
  "JFM!J8:M14"
];

let currentSlide = 0;
let slideInterval = null;
let isPlaying = true;

function parseRange(range) {
  const [, cells] = range.split("!");
  const [start] = cells.split(":");
  const colLetters = start.match(/[A-Z]+/)[0];
  const rowNumber = parseInt(start.match(/\d+/)[0], 10);
  const startCol = colLetters
    .split("")
    .reduce((sum, c) => sum * 26 + (c.charCodeAt(0) - 64), 0) - 1;
  return { startRow: rowNumber - 1, startCol };
}

function buildURL(range) {
  return `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}?ranges=${encodeURIComponent(range)}&includeGridData=true&fields=sheets.data.rowData.values(formattedValue,userEnteredFormat),sheets.merges&key=${API_KEY}`;
}

async function fetchSheetData(range) {
  const res = await fetch(buildURL(range));
  const data = await res.json();
  if (!res.ok) throw new Error(JSON.stringify(data));
  return {
    rows: data.sheets?.[0]?.data?.[0]?.rowData || [],
    merges: data.sheets?.[0]?.merges || []
  };
}

function applyStyles(td, format) {
  if (!format) return;

  if (format.backgroundColor || format.backgroundColorStyle?.rgbColor) {
    const c = format.backgroundColor || format.backgroundColorStyle?.rgbColor;
    const r = Math.round((c.red || 0) * 255);
    const g = Math.round((c.green || 0) * 255);
    const b = Math.round((c.blue || 0) * 255);
    const a = c.alpha ?? 1;
    td.style.backgroundColor = `rgba(${r},${g},${b},${a})`;
  }

  if (format.textFormat?.bold) {
    td.style.fontWeight = "900";
    td.classList.add("bold");
  }
}

function getMergeInfo(merges, row, col, offset) {
  const absRow = row + offset.startRow;
  const absCol = col + offset.startCol;

  for (const m of merges) {
    if (absRow === m.startRowIndex && absCol === m.startColumnIndex) {
      return {
        rowspan: m.endRowIndex - m.startRowIndex,
        colspan: m.endColumnIndex - m.startColumnIndex
      };
    }
    if (
      absRow >= m.startRowIndex &&
      absRow < m.endRowIndex &&
      absCol >= m.startColumnIndex &&
      absCol < m.endColumnIndex
    ) {
      return "SKIP";
    }
  }
  return null;
}

function adjustFontSize() {
  const container = document.getElementById("report-container");
  const table = container.querySelector("table");
  if (!table) return;
  const rows = table.rows.length;
  table.style.fontSize = Math.floor(container.clientHeight / rows * 0.55) + "px";
}

function renderTable(rows, merges, offset) {
  const container = document.getElementById("report-container");
  container.innerHTML = "";
  const table = document.createElement("table");

  rows.forEach((row, rIndex) => {
    const tr = document.createElement("tr");
    (row.values || []).forEach((cell, cIndex) => {
      const merge = getMergeInfo(merges, rIndex, cIndex, offset);
      if (merge === "SKIP") return;

      const td = document.createElement(rIndex === 0 ? "th" : "td");
      td.innerText = cell?.formattedValue || "";

      if (merge) {
        td.rowSpan = merge.rowspan;
        td.colSpan = merge.colspan;
      }

      applyStyles(td, cell?.userEnteredFormat);
      tr.appendChild(td);
    });
    table.appendChild(tr);
  });

  container.appendChild(table);
  adjustFontSize();
}

async function loadSlide(slideIndex = null) {
  const container = document.getElementById("report-container");
  container.classList.add("fade");

  setTimeout(async () => {
    try {
      if (slideIndex !== null) currentSlide = slideIndex;
      const range = RANGES[currentSlide];
      const offset = parseRange(range);
      const { rows, merges } = await fetchSheetData(range);
      renderTable(rows, merges, offset);
    } catch (e) {
      container.innerText = "Error loading data";
      console.error(e);
    }
    container.classList.remove("fade");
  }, 300);
}

/* ===== AUTO SLIDE ===== */
function startSlideShow() {
  if (slideInterval) clearInterval(slideInterval);
  slideInterval = setInterval(() => {
    currentSlide = (currentSlide + 1) % RANGES.length;
    loadSlide();
  }, 5000);
  document.getElementById("play-pause").innerText = "Pause";
  isPlaying = true;
}

function stopSlideShow() {
  if (slideInterval) clearInterval(slideInterval);
  document.getElementById("play-pause").innerText = "Play";
  isPlaying = false;
}

/* ===== BUTTON EVENTS ===== */
document.getElementById("play-pause").addEventListener("click", () => {
  if (isPlaying) stopSlideShow();
  else startSlideShow();
});

document.getElementById("prev-slide").addEventListener("click", () => {
  stopSlideShow();
  currentSlide = (currentSlide - 1 + RANGES.length) % RANGES.length;
  loadSlide();
});

document.getElementById("next-slide").addEventListener("click", () => {
  stopSlideShow();
  currentSlide = (currentSlide + 1) % RANGES.length;
  loadSlide();
});

/* ===== INIT ===== */
loadSlide();
startSlideShow();
</script>

</body>
</html>

